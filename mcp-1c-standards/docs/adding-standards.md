# Инструкция: как добавить стандарты

Ниже — пошаговая инструкция по добавлению новых стандартов в контент MCP 1C Standards и в справочник (lookup), чтобы по ним можно было получать полный текст через инструмент **standards_lookup**.

## 1. Узнать ID стандарта

Стандарты в ИТС имеют числовой ID. Он виден в URL страницы стандарта на [its.1c.ru](https://its.1c.ru/db/v8std):

- Содержание: <https://its.1c.ru/db/v8std#browse:13:-1>
- Пример страницы стандарта: `https://its.1c.ru/db/v8std/content/453/hdoc` → ID = **453**.

Либо откройте нужный подраздел (например «Соглашения при написании кода», «Реализация обработки данных») и возьмите ID из ссылок на разделы вида `.../content/<id>/hdoc`.

## 2. Добавить ID в скрипт загрузки (если нужно)

Список ID, которые скрипт пытается скачать с v8std.ru, задаётся в `scripts/fetch_standards.py` в константах вида `STD_IDS_SECTION_*` и в `ALL_STD_IDS`. Если ваш ID ещё не входит в этот список:

- Откройте `scripts/fetch_standards.py`.
- Добавьте ID в подходящую секцию (или в конец списка `ALL_STD_IDS` перед `sorted(set(...))`).
- Сохраните файл.

Если ID уже есть в `ALL_STD_IDS`, этот шаг можно пропустить.

## 3. Скачать страницу стандарта с v8std.ru

Из корня проекта выполните:

```bash
python3 scripts/fetch_standards.py [id1] [id2] ...
```

Примеры:

```bash
# Скачать только стандарты 453 и 641
python3 scripts/fetch_standards.py 453 641

# Скачать все ID из списка в скрипте
python3 scripts/fetch_standards.py
```

Скрипт:

- запрашивает страницы `https://v8std.ru/std/<id>/`;
- конвертирует HTML в Markdown;
- сохраняет результат в `content/std-<id>.md`;
- если страница не найдена (404) или слишком короткая, файл не создаётся (или не перезаписывается).

Проверьте, что в каталоге `content/` появился файл `std-<id>.md`. Если на v8std.ru этого стандарта нет, файл можно подготовить вручную и положить в `content/` с именем `std-<id>.md`.

## 4. Добавить раздел в lookup.json

Чтобы инструмент **standards_lookup** по запросу с `topic: <id>` возвращал полный текст и ссылку на ИТС, нужно добавить запись в `content/lookup.json`.

Откройте `content/lookup.json`. В массиве `sections` добавьте объект (можно в конец, перед закрывающей `]`):

```json
{
  "id": "<id>",
  "title": "Название стандарта как на ИТС",
  "summary": "Краткое описание в одно-два предложения.",
  "url": "https://its.1c.ru/db/v8std/content/<id>/hdoc",
  "localFile": "std-<id>.md"
}
```

Пример для стандарта 453:

```json
{
  "id": "453",
  "title": "Описание процедур и функций",
  "summary": "Правила оформления документирующих комментариев к процедурам и функциям: описание, параметры (имя, тип, назначение), возвращаемое значение.",
  "url": "https://its.1c.ru/db/v8std/content/453/hdoc",
  "localFile": "std-453.md"
}
```

- **id** — строка с номером стандарта (или символьный идентификатор, например `doc-comment`, `naming`).
- **title**, **summary** — для отображения в ответе lookup; summary можно взять из первого абзаца `std-<id>.md` или с ИТС.
- **url** — ссылка на страницу стандарта в ИТС (для числовых ID: `https://its.1c.ru/db/v8std/content/<id>/hdoc`).
- **localFile** — имя файла в каталоге контента; если указано и файл есть, в ответ lookup подставляется полный текст из этого файла.

Сохраните `lookup.json`. Проверьте, что JSON корректен (запятые, кавычки, скобки).

## 5. Обновить встроенный контент (embed) и пересобрать

Чтобы новый стандарт был доступен и при запуске без каталога `content/` (только из бинарника), нужно положить файлы во встраиваемый контент и пересобрать проект:

1. Скопировать новый файл стандарта в `internal/tools/content/`:
   ```bash
   cp content/std-<id>.md internal/tools/content/
   ```

2. Скопировать обновлённый `lookup.json`:
   ```bash
   cp content/lookup.json internal/tools/content/
   ```

3. Пересобрать бинарник:
   ```bash
   go build -o mcp-1c-standards .
   ```

После этого вызов **standards_lookup** с `topic: <id>` будет возвращать полный текст из `std-<id>.md` (из каталога контента или из embed).

## 6. Добавить стандарт без v8std.ru (вручную)

Если стандарта нет на v8std.ru или нужен свой текст:

1. Создайте файл `content/std-<id>.md` с содержимым в Markdown.
2. Выполните шаги **4** и **5**: добавьте запись в `content/lookup.json` с `localFile: "std-<id>.md"` и при необходимости скопируйте файл и `lookup.json` в `internal/tools/content/`, затем выполните `go build`.

## Краткий чеклист

- [ ] Узнать ID стандарта (ИТС или скрипт).
- [ ] При необходимости добавить ID в `scripts/fetch_standards.py` → `ALL_STD_IDS`.
- [ ] Запустить `python3 scripts/fetch_standards.py [id]` или вручную создать `content/std-<id>.md`.
- [ ] Добавить запись в `content/lookup.json` (id, title, summary, url, localFile).
- [ ] Скопировать `content/std-<id>.md` и `content/lookup.json` в `internal/tools/content/`.
- [ ] Выполнить `go build -o mcp-1c-standards .`.

Готовый стандарт будет доступен через **standards_lookup** по `topic: <id>`.
